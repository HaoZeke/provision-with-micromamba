name: options
on:
  push:
    branches:
      - main
  pull_request: null

jobs:
  test:
    runs-on: ${{ matrix.os }}
    strategy:
      fail-fast: false
      matrix:
        os: [windows-latest, ubuntu-latest, macos-latest]
    name: option
    steps:
      - uses: actions/checkout@v2

      - name: install mamba
        uses: ./
        with:
          environment-file: environment.yml
          environment-name: myenv

      - name: run python in powershell
        shell: powershell
        run: |
          python -VV
          python -c "import numpy"
        if: runner.os == 'Windows'

      - name: run python in bash
        shell: bash -l {0}
        run: |
          python -VV
          python -c "import numpy"
          micromamba --help
        if: runner.os != 'Windows'

      - name: test environment name in powershell
        shell: powershell
        run: |
          python -c "import subprocess; ret = subprocess.check_output(['conda', 'info']).decode('utf-8'); assert ret.split('active environment : ')[1].split('/')[-1].split('\n')[0] == 'myenv'"
        if: runner.os == 'Windows'

      - name: test environment name in bash
        shell: bash -l {0}
        run: |
          python -c "import subprocess; ret = subprocess.check_output(['conda', 'info']).decode('utf-8'); assert ret.split('active environment : ')[1].split('/')[-1].split('\n')[0] == 'myenv'"
        if: runner.os != 'Windows'
